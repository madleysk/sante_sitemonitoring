{% extends "layout.html" %}

{% block body %}
<style>
.donut-inner{
margin-top: -25%;
margin-bottom: 20%;
font-weight: bold;
}
</style>
<!-- Content Header (Page header) -->
    <section class="content-header">
      
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-md-4">
          <!-- DONUT CHART -->
          <div class="card">
            <div class="card-title">
              <h3 class="text-center">Internet status</h3>
            </div>
            <div class="card-body p-1">
              <canvas id="pieChartInt" style="height:250px"></canvas>
		<div class="donut-inner text-center"><span></span></div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col (RIGHT) -->
        <div class="col-md-4">
          <!-- DONUT CHART -->
          <div class="card">
            <div class="card-title">
              <h3 class="text-center">Isante status</h3>
            </div>
            <div class="card-body p-1">
              <canvas id="pieChartIsante" style="height:250px"></canvas>
		<div class="donut-inner text-center"><span></span></div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col (RIGHT) -->
        <div class="col-md-4">
          <!-- DONUT CHART -->
          <div class="card">
            <div class="card-title">
              <h3 class="text-center">Fingerprint status</h3>
            </div>
            <div class="card-body p-1">
              <canvas id="pieChartFing" style="height:250px"></canvas>
		<div class="donut-inner text-center"><span></span></div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col (RIGHT) -->
      </div>
      <!-- /.row -->
	<div class="row mt-3 mb-3">
		<div class="col-md-8">
			<div class="card">
				<div class="card-title bg-danger"><h4 class="text-center" style="color:white;">Evenements recents</h4></div>
				<div class="card-body p-0 table-responsive">
					<table class="table table-striped table-hover">
						<th>Status</th><th>Site</th><th>date rapporte</th>
						{% for event in data['recent_events'] %}
						<tr class="{{event.status_ev}} togle-case"><td>{{event.element}} {{event.status_ev}}</td><td>{{event.nom}}</td><td>{{event.date_rap}}</td></tr>
						{% endfor %}
					</table>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card">
				<div class="card-title bg-danger"><h4 class="text-center" style="color:white;">Top 5 sites a problemes</h4></div>
				<div class="card-body p-0 table-responsive">
					<table class="table table-striped table-hover">
						<th class="text-center">Nom site</th>
						{% for bad_site in data['top_bad_sites'] %}
						<tr><td class="down">{{bad_site.nom_site}}</td></tr>
						{% endfor %}
					</table>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-3" style="margin:auto;">
			<select name="filter" class="form-control" onchange="filter(this)">
				<option value="all" {% if filtre == 'all'%} selected {% endif %}>-- Filtrage --</option>
				<option value="CENTRE" {% if filtre == 'CENTRE'%} selected {% endif %}>Region Centre</option>
				<option value="NORD" {% if filtre == 'NORD'%} selected {% endif %}>Region Nord</option>
				<option value="SUD" {% if filtre == 'SUD'%} selected {% endif %}>Region Sud</option>
			</select>
		</div>
	</div>
    </section>
    
<!-- jQuery 3 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- Bootstrap 4.4.1 JS compiled -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<!-- ChartJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<!-- FastClick -->
<script src="https://cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<!-- page script -->
<script>
	//Filter script
	function filter(obj){
		var current_url= "{{url_for('index')}}";
		var val= obj.value;
		window.location.replace(current_url+'?filter='+val);
	}
	//Chart script
  $(function () {
    /* ChartJS
     * -------
     * Here we will create a few charts using ChartJS
     */

    //-------------
    //- PIE CHART - Internet
    //-------------
    new Chart(document.getElementById("pieChartInt"), {
	type:'doughnut',
	data: {
		labels: ['Connexion UP','Connexion Down'],
		datasets:[{
		label: "Internet Status",
		backgroundColor:["#00a65a","#f56954"],
		data:[{{data['internet_status']['up']}},{{data['internet_status']['down']}}]
		}]
	},
	options:{
		title:{
		display: false,
		text: 'Sites Internet Status'
		}
		}
	});
	
	
	//-------------
    //- PIE CHART - Isante
    //-------------
    new Chart(document.getElementById("pieChartIsante"), {
	type:'doughnut',
	data: {
		labels: ['Serveur UP','Serveur Down'],
		datasets:[{
		label: "Isante Status",
		backgroundColor:["#00a65a","#f56954"],
		data:[{{data['isante_status']['up']}},{{data['isante_status']['down']}}]
		}]
	},
	options:{
		title:{
		display: false,
		text: 'Sites Internet Status'
		}
		}
	});
    
    //-------------
    //- PIE CHART - Fingerprint
    //-------------
    new Chart(document.getElementById("pieChartFing"), {
	type:'doughnut',
	data: {
		labels: ['Serveur UP','Serveur Down'],
		datasets:[{
		label: "Fingerprint Status",
		backgroundColor:["#00a65a","#f56954"],
		data:[{{data['fingerprint_status']['up']}},{{data['fingerprint_status']['down']}}]
		}]
	},
	options:{
		title:{
		display: false,
		text: 'Sites Internet Status'
		}
		}
	});

  })
</script>

{% endblock body %}
